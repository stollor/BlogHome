let SpriteSmith=require("spritesmith");const Path=require("path"),Fs=require("fs");module.exports={_getCharImageMaxHeight(e){let t=0;return e.forEach(e=>{e.height>t&&(t=e.height)}),t},checkAllCharIsSameHeight(e){let t=null;for(let i=0;i<e.length;i++){let a=e[i];if(0===i)t=a.height;else if(a.height!==t)return!1}return!0},gen(e,t,i){let a=[];e.forEach(e=>{a.push(e.image)});let h=2;void 0!==t.padding&&(h=t.padding),SpriteSmith.run({src:a,algorithm:"binary-tree",padding:h},(a,h)=>{if(a);else{let a=h.properties.width,r=h.properties.height,n=this._getCharImageMaxHeight(e),l=`info face="${t.face||"face"}" size=${t.fontSize||n}\n`,g=`common lineHeight=${n} scaleW=${a} scaleH=${r} pages=1\n`,o=`page id=0 file="${t.name}.png"\n`,s=`chars count=${e.length}\n`,f="";for(let t in h.coordinates){let a=this._setCharData(t,h.coordinates[t],e);if(!a)return i&&i({msg:`该图片没有设置字符:${t}`});f+=a}let c=l+g+o+s+f,d=Path.join(t.path,`${t.name}.fnt`);Fs.writeFileSync(d,c);let p=Path.join(t.path,`${t.name}.png`);Fs.writeFileSync(p,h.image),i&&i(null)}})},_setCharData(e,t,i){let a=null;for(let t=0;t<i.length;t++){let h=i[t];if(h.image===e){a=h;break}}if(a){let e=a.char.charCodeAt(0),{x:i,y:h,width:r,height:n}=t,l=a.xoffset||0,g=a.yoffset||0,o=r;return void 0!==a.xadvance&&(o=a.xadvance),`char id=${e} x=${i} y=${h} width=${r} height=${n} xoffset=${Math.round(l)} yoffset=${Math.round(g)} xadvance=${Math.round(o)} page=0 chnl=15\n`}return null}};