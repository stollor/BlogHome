let GenBmFont=require("../../core/GenBmFont");const FsExtra=require("fs-extra"),Path=require("path"),Electron=require("electron");FontEngine.Save=module.exports={genBMFont(e){let t=FontEngine.allFont,a=[],n=1e4;for(let e=0;e<t.length;e++){let r=t[e],o=this._getFontBase64Image(r);const i=require("../../core/Profile");let s=Path.join(i.ProjectPath,`temp/${r.string.charCodeAt(0)}.png`);FsExtra.ensureFileSync(s),FsExtra.writeFileSync(s,o,"base64");let h=r.getXAdvance(),c=r.getBoundingBox();n=Math.min(c.y1,n),a.push({char:r.string,image:s,width:r.width,height:r.height,xadvance:h,xoffset:c.x1,yoffset:0,y1:c.y1})}a.forEach(e=>{e.yoffset=e.y1-n}),a=a.sort((e,t)=>{return e.char.charCodeAt(0)-t.char.charCodeAt(0)}),GenBmFont.gen(a,{name:e.saveName,path:e.savePath,face:e.saveName,fontSize:e.font.size,padding:e.space},()=>{a.forEach(e=>{FsExtra.unlinkSync(e.image)});let t=e.savePath;t&&FsExtra.existsSync(t)&&(Electron.shell.showItemInFolder(t),Electron.shell.beep())})},_getFontBase64Image(e){let t=document.createElement("canvas"),a=t.getContext("2d"),{width:n,height:r,texture:o}=e;t.setAttribute("height",r),t.setAttribute("width",n),a.putImageData(o,0,0);let i=t.toDataURL("image/png");return t.remove(),i.replace(/^data:image\/png;base64,/,"")}};