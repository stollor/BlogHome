const Fs=require("fs"),Path=require("path"),Msg=require("../msg.js"),Vue=require("../../lib/vue.min.js"),Electron=require("electron");module.exports=Vue.component("char-item",{props:["data","index","chars"],template:Fs.readFileSync(Path.join(__dirname,"item.html"),"utf8"),data:()=>({}),created(){this.$nextTick(()=>{this.onMouseOut()}),this.$root.$on("OnDropChars",()=>{})},computed:{errorChar(){let e=this.data.char;return void 0===e||null===e||""===e||!!this.checkIsContentRepeatChar(e)}},methods:{_createRightMenu(e){const t=require("electron").remote,r=t.Menu,n=t.MenuItem;let a=new r;for(let t=0;t<e.length;t++)a.append(new n(e[t]));let o=t.getCurrentWindow();a.popup(o)},onMenu(e){let t=[{label:"删除",click:()=>{this.onClickBtnDel()}},{type:"separator"},{label:"删除全部",click(){Editor.Ipc.sendToPanel("bitmap-font","onClickDelAllChar",this.data)}}];this._createRightMenu(t)},onMouseOver(){this.$el.style.backgroundColor="#666"},onMouseOut(){this.$el.style.backgroundColor=this.index%2?"#555":"#444"},checkIsContentRepeatChar(e){let t=JSON.parse(JSON.stringify(this.chars)),r=[];for(let n=0;n<t.length;n++){let a=t[n];a.char===e&&r.push(a)}if(r.length>1){let t=`发现多张图片对应同一个字符[${e}] :\n`;for(let e=0;e<r.length;e++)t+=r[e].image+"\n";return Editor.Message.send("bitmap-font","fontPanelLog",`字符(${this.data.char})设置重复:${this.data.image}`),!0}return!1},onInputChar(e){let t=e.target.value;t="string"==typeof t?t[0]:"",this.data.char=t,require("../cfg").saveConfig()},onClickBtnDel(e){this.$root.$emit(Msg.OnCharDel,this.data)}}});